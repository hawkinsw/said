# Whois

`whois` is an amazing utility for malware analysts, especially when it comes time to determine the provenance of infrastructure propping up command-and-control (C&C) servers. 

`whois` can be used to query registrars for information about the entity delegated control over a domain (e.g., `google.com`) or a range of IP addresses (e.g., Amazon might control the allocation of IP addresses between 52.84.0.0 - 52.95.255.255). `whois` can query other information, but these are the most common uses.

> Note: If you are interested in the organizations that determine who "owns" resources on the Internet, read up on [IANA](https://en.wikipedia.org/wiki/Internet_Assigned_Numbers_Authority), [ARIN](https://en.wikipedia.org/wiki/American_Registry_for_Internet_Numbers) (just *one* of the regional internet registries), or [ICANN](https://en.wikipedia.org/wiki/ICANN).

When analysts first discover a piece of malware that relies on C&C servers the first thing they do is determine which company "owns" the block of IP addresses within which the C&C server falls.

> In this SAID, we will say that names and address ranges are "owned" by particular organizations but the reality is far more subtle than that. If you are interested in learning more about the policies and procedures of network allocations, read more about the entities listed above.

In the past, this information was more useful. Today, because AWS, Azure, GCP (etc.) effectively control large swaths of IP space, `whois` is slightly less useful. Nevertheless, it's a fun tool to know how to use.

## Terminal

`whois` is a command-line utility. Before continuing, make sure that you have access to a terminal emulator.

## Who Are You?

The `whois` utility is flexible and largely responsive to your input, without any special customization. It can detect the proper behavior given the type of parameter you provide ...

### Domain Name

One use for `whois` is to determine to whom a domain name is registered. 

```console
$ whois google.com
```

will direct `whois` to retrieve information about the ownership of a domain name, in this case `google.com`. The result is some relatively readable and informative information:

```
  Domain Name: GOOGLE.COM
   Registry Domain ID: 2138514_DOMAIN_COM-VRSN
   Registrar WHOIS Server: whois.markmonitor.com
   Registrar URL: http://www.markmonitor.com
   Updated Date: 2019-09-09T15:39:04Z
   Creation Date: 1997-09-15T04:00:00Z
   Registry Expiry Date: 2028-09-14T04:00:00Z
   Registrar: MarkMonitor Inc.
   Registrar IANA ID: 292
   Registrar Abuse Contact Email: abusecomplaints@markmonitor.com
   Registrar Abuse Contact Phone: +1.2086851750
   Domain Status: clientDeleteProhibited https://icann.org/epp#clientDeleteProhibited
   Domain Status: clientTransferProhibited https://icann.org/epp#clientTransferProhibited
   Domain Status: clientUpdateProhibited https://icann.org/epp#clientUpdateProhibited
   Domain Status: serverDeleteProhibited https://icann.org/epp#serverDeleteProhibited
   Domain Status: serverTransferProhibited https://icann.org/epp#serverTransferProhibited
   Domain Status: serverUpdateProhibited https://icann.org/epp#serverUpdateProhibited
   Name Server: NS1.GOOGLE.COM
   Name Server: NS2.GOOGLE.COM
   Name Server: NS3.GOOGLE.COM
   Name Server: NS4.GOOGLE.COM
   DNSSEC: unsigned
   ...
Registrant Organization: Google LLC
Registrant State/Province: CA
Registrant Country: US
Registrant Email: Select Request Email Form at https://domains.markmonitor.com/whois/google.com
Admin Organization: Google LLC
Admin State/Province: CA
Admin Country: US
Admin Email: Select Request Email Form at https://domains.markmonitor.com/whois/google.com
Tech Organization: Google LLC
Tech State/Province: CA
Tech Country: US
Tech Email: Select Request Email Form at https://domains.markmonitor.com/whois/google.com
Name Server: ns3.google.com
Name Server: ns2.google.com
Name Server: ns4.google.com
Name Server: ns1.google.com
DNSSEC: unsigned
URL of the ICANN WHOIS Data Problem Reporting System: http://wdprs.internic.net/
>>> Last update of WHOIS database: 2023-03-01T18:00:26+0000 <<<
...
```

(some output snipped)

### IP Address

The other utility of `whois` is to learn who owns certain ranges of IP addresses. For instance, the website `slashdot.org` is hosted at the IP address `104.18.28.86`. We can use `whois` to determine who owns that IP address:

```console
$ whois 104.18.28.86
```

Again, the resulting output is both semi-readable and informative:

```
#
# ARIN WHOIS data and services are subject to the Terms of Use
# available at: https://www.arin.net/resources/registry/whois/tou/
#
# If you see inaccuracies in the results, please report at
# https://www.arin.net/resources/registry/whois/inaccuracy_reporting/
#
# Copyright 1997-2023, American Registry for Internet Numbers, Ltd.
#


NetRange:       104.16.0.0 - 104.31.255.255
CIDR:           104.16.0.0/12
NetName:        CLOUDFLARENET
NetHandle:      NET-104-16-0-0-1
Parent:         NET104 (NET-104-0-0-0-0)
NetType:        Direct Allocation
OriginAS:       AS13335
Organization:   Cloudflare, Inc. (CLOUD14)
RegDate:        2014-03-28
Updated:        2021-05-26
Comment:        All Cloudflare abuse reporting can be done via https://www.cloudflare.com/abuse
Ref:            https://rdap.arin.net/registry/ip/104.16.0.0



OrgName:        Cloudflare, Inc.
OrgId:          CLOUD14
Address:        101 Townsend Street
City:           San Francisco
StateProv:      CA
PostalCode:     94107
Country:        US
RegDate:        2010-07-09
Updated:        2021-07-01
Ref:            https://rdap.arin.net/registry/entity/CLOUD14


OrgRoutingHandle: CLOUD146-ARIN
OrgRoutingName:   Cloudflare-NOC
OrgRoutingPhone:  +1-650-319-8930 
OrgRoutingEmail:  noc@cloudflare.com
OrgRoutingRef:    https://rdap.arin.net/registry/entity/CLOUD146-ARIN

OrgTechHandle: ADMIN2521-ARIN
OrgTechName:   Admin
OrgTechPhone:  +1-650-319-8930 
OrgTechEmail:  rir@cloudflare.com
OrgTechRef:    https://rdap.arin.net/registry/entity/ADMIN2521-ARIN

OrgNOCHandle: CLOUD146-ARIN
OrgNOCName:   Cloudflare-NOC
OrgNOCPhone:  +1-650-319-8930 
OrgNOCEmail:  noc@cloudflare.com
OrgNOCRef:    https://rdap.arin.net/registry/entity/CLOUD146-ARIN

OrgAbuseHandle: ABUSE2916-ARIN
OrgAbuseName:   Abuse
OrgAbusePhone:  +1-650-319-8930 
OrgAbuseEmail:  abuse@cloudflare.com
OrgAbuseRef:    https://rdap.arin.net/registry/entity/ABUSE2916-ARIN

RTechHandle: ADMIN2521-ARIN
RTechName:   Admin
RTechPhone:  +1-650-319-8930 
RTechEmail:  rir@cloudflare.com
RTechRef:    https://rdap.arin.net/registry/entity/ADMIN2521-ARIN

RAbuseHandle: ABUSE2916-ARIN
RAbuseName:   Abuse
RAbusePhone:  +1-650-319-8930 
RAbuseEmail:  abuse@cloudflare.com
RAbuseRef:    https://rdap.arin.net/registry/entity/ABUSE2916-ARIN

RNOCHandle: NOC11962-ARIN
RNOCName:   NOC
RNOCPhone:  +1-650-319-8930 
RNOCEmail:  noc@cloudflare.com
RNOCRef:    https://rdap.arin.net/registry/entity/NOC11962-ARIN


#
# ARIN WHOIS data and services are subject to the Terms of Use
# available at: https://www.arin.net/resources/registry/whois/tou/
#
# If you see inaccuracies in the results, please report at
# https://www.arin.net/resources/registry/whois/inaccuracy_reporting/
#
# Copyright 1997-2023, American Registry for Internet Numbers, Ltd.
#
```

Based on my interpretation of that data, `slashdot.org` is hosted on a server whose IP address belongs to a range of IP addresses (104.16.0.0 - 104.31.255.255) owned by Cloudflare!

## Say As I Do

1. Determine when the `cincinnati.com` domain name was originally registered by its current owner.
2. Determine who owns the IP range encompassing the address `192.24.129.1`.

[Answer](./whois-ans.md)